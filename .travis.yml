sudo: required
services:
  - docker
before_script:
  - docker-compose -f pact-tools/pact-broker/docker-compose.yml up -d
  - docker build -t pact-cli pact-tools/pact-cli

language: java
jdk:
  - oraclejdk11
script:
  - mvn clean verify -Pcode-coverage
  - mvn verify -Pconsumer-pacts
  - /bin/bash pact-tools/scripts/publish-pacts.sh
  - mvn verify -Pprovider-pacts -Dpact.verifier.publishResults=true
cache:
  directories:
  - $HOME/.m2

after_success:
  - mvn coveralls:report -Pcode-coverage

after_script:
  - docker-compose -f pact-tools/pact-broker/docker-compose.yml down
